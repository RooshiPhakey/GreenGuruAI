import { useEffect, useRef, useState } from 'react'
export default function Chat(){const[messages,setMessages]=useState([{role:'assistant',content:"Hey! I'm Blaze — your GreenGuru AI. Here to chat all things cannabis: strains, growing tips, safe use, and the latest industry news. 100% anonymous, judgment-free ✌️"}]);const[input,setInput]=useState('');const[loading,setLoading]=useState(false);const bottomRef=useRef(null);useEffect(()=>{bottomRef.current?.scrollIntoView({behavior:'smooth'})},[messages]);async function sendMessage(e){e.preventDefault();const content=input.trim();if(!content)return;const next=[...messages,{role:'user',content}];setMessages(next);setInput('');setLoading(true);try{const res=await fetch('/api/chat',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({messages:next.slice(-10)})});const data=await res.json();if(data.reply){setMessages([...next,{role:'assistant',content:data.reply}])}else{const hint=data.error?` (${data.error}${data.details?': '+data.details:''})`:'';setMessages([...next,{role:'assistant',content:'Sorry, I had trouble answering. Please try again.'+hint}])}}catch(err){setMessages([...next,{role:'assistant',content:'Network error. Please try again.'}])}finally{setLoading(false)}}const quick=['📍 Is cannabis legal in the UK?','💡 Give me safer-use tips','🛠 What gear do you recommend for beginners?'];return(<div className="card"><div style={{display:'flex',flexDirection:'column',gap:8,minHeight:420}}><div style={{marginTop:4,marginBottom:8,display:'flex',flexWrap:'wrap',gap:8}}>{quick.map((q,idx)=>(<button key={idx} type="button" className="btn" style={{fontSize:12,padding:'6px 10px'}} onClick={()=>setInput(q)}>{q}</button>))}</div>{messages.map((m,i)=>(<div key={i} className={'bubble '+(m.role==='user'?'user':'bot')}>{m.content}</div>))}<div ref={bottomRef}/></div><form onSubmit={sendMessage} className="row" style={{marginTop:12}}><input className="input" placeholder="Ask Blaze…" value={input} onChange={e=>setInput(e.target.value)} disabled={loading}/><button className="btn" disabled={loading}>{loading?'Thinking…':'Send'}</button></form><p className="legal" style={{marginTop:12}}>Educational purposes only. Not medical or legal advice. For adults where lawful.</p></div>) }